<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP
           , NoImplicitPrelude
           , RecordWildCards
           , NondecreasingIndentation
  #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-matches #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Module      :  GHC.IO.Handle</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow, 1994-2009</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- License     :  see libraries/base/LICENSE</span><span>
</span><a name="line-14"></a><span class="hs-comment">--</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- Portability :  non-portable</span><span>
</span><a name="line-18"></a><span class="hs-comment">--</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- External API for GHC's Handle implementation</span><span>
</span><a name="line-20"></a><span class="hs-comment">--</span><span>
</span><a name="line-21"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.IO.Handle</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-24"></a><span>   </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>   </span><a href="GHC.IO.Handle.Types.html#BufferMode"><span class="hs-identifier hs-type">BufferMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>   </span><a href="GHC.IO.Handle.Internals.html#mkFileHandle"><span class="hs-identifier hs-var">mkFileHandle</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Internals.html#mkDuplexHandle"><span class="hs-identifier hs-var">mkDuplexHandle</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>   </span><a href="GHC.IO.Handle.html#hFileSize"><span class="hs-identifier hs-var">hFileSize</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hSetFileSize"><span class="hs-identifier hs-var">hSetFileSize</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsEOF"><span class="hs-identifier hs-var">hIsEOF</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#isEOF"><span class="hs-identifier hs-var">isEOF</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hLookAhead"><span class="hs-identifier hs-var">hLookAhead</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>   </span><a href="GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier hs-var">hSetBuffering</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hSetBinaryMode"><span class="hs-identifier hs-var">hSetBinaryMode</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hSetEncoding"><span class="hs-identifier hs-var">hSetEncoding</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hGetEncoding"><span class="hs-identifier hs-var">hGetEncoding</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>   </span><a href="GHC.IO.Handle.html#hFlush"><span class="hs-identifier hs-var">hFlush</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hFlushAll"><span class="hs-identifier hs-var">hFlushAll</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hDuplicate"><span class="hs-identifier hs-var">hDuplicate</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hDuplicateTo"><span class="hs-identifier hs-var">hDuplicateTo</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>   </span><a href="GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Internals.html#hClose_help"><span class="hs-identifier hs-var">hClose_help</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>   </span><a href="GHC.IO.Handle.Lock.html#LockMode"><span class="hs-identifier hs-type">LockMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Lock.html#hLock"><span class="hs-identifier hs-var">hLock</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Lock.html#hTryLock"><span class="hs-identifier hs-var">hTryLock</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>   </span><a href="GHC.IO.Handle.html#HandlePosition"><span class="hs-identifier hs-type">HandlePosition</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-type">HandlePosn</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hGetPosn"><span class="hs-identifier hs-var">hGetPosn</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hSetPosn"><span class="hs-identifier hs-var">hSetPosn</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>   </span><a href="GHC.IO.Device.html#SeekMode"><span class="hs-identifier hs-type">SeekMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hSeek"><span class="hs-identifier hs-var">hSeek</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hTell"><span class="hs-identifier hs-var">hTell</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>   </span><a href="GHC.IO.Handle.html#hIsOpen"><span class="hs-identifier hs-var">hIsOpen</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsClosed"><span class="hs-identifier hs-var">hIsClosed</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsReadable"><span class="hs-identifier hs-var">hIsReadable</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsWritable"><span class="hs-identifier hs-var">hIsWritable</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hGetBuffering"><span class="hs-identifier hs-var">hGetBuffering</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsSeekable"><span class="hs-identifier hs-var">hIsSeekable</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>   </span><a href="GHC.IO.Handle.html#hSetEcho"><span class="hs-identifier hs-var">hSetEcho</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hGetEcho"><span class="hs-identifier hs-var">hGetEcho</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.html#hIsTerminalDevice"><span class="hs-identifier hs-var">hIsTerminalDevice</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>   </span><a href="GHC.IO.Handle.html#hSetNewlineMode"><span class="hs-identifier hs-var">hSetNewlineMode</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Types.html#Newline"><span class="hs-identifier hs-type">Newline</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Types.html#NewlineMode"><span class="hs-identifier hs-type">NewlineMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Types.html#nativeNewline"><span class="hs-identifier hs-var">nativeNewline</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>   </span><a href="GHC.IO.Handle.Types.html#noNewlineTranslation"><span class="hs-identifier hs-var">noNewlineTranslation</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Types.html#universalNewlineMode"><span class="hs-identifier hs-var">universalNewlineMode</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Types.html#nativeNewlineMode"><span class="hs-identifier hs-var">nativeNewlineMode</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>   </span><a href="GHC.IO.Handle.html#hShow"><span class="hs-identifier hs-var">hShow</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>   </span><a href="GHC.IO.Handle.Text.html#hWaitForInput"><span class="hs-identifier hs-var">hWaitForInput</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hGetChar"><span class="hs-identifier hs-var">hGetChar</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hGetContents"><span class="hs-identifier hs-var">hGetContents</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hPutChar"><span class="hs-identifier hs-var">hPutChar</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>   </span><a href="GHC.IO.Handle.Text.html#hGetBuf"><span class="hs-identifier hs-var">hGetBuf</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hGetBufNonBlocking"><span class="hs-identifier hs-var">hGetBufNonBlocking</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hPutBuf"><span class="hs-identifier hs-var">hPutBuf</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.Handle.Text.html#hPutBufNonBlocking"><span class="hs-identifier hs-var">hPutBufNonBlocking</span></a><span>
</span><a name="line-51"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.html"><span class="hs-identifier">GHC.IO</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Exception.html"><span class="hs-identifier">GHC.IO.Exception</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Encoding.html"><span class="hs-identifier">GHC.IO.Encoding</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Buffer.html"><span class="hs-identifier">GHC.IO.Buffer</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.BufferedIO.html"><span class="hs-identifier">GHC.IO.BufferedIO</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="GHC.IO.BufferedIO.html#BufferedIO"><span class="hs-identifier hs-type">BufferedIO</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Device.html"><span class="hs-identifier">GHC.IO.Device</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IODevice</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Handle.FD.html"><span class="hs-identifier">GHC.IO.Handle.FD</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Handle.Lock.html"><span class="hs-identifier">GHC.IO.Handle.Lock</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Handle.Types.html"><span class="hs-identifier">GHC.IO.Handle.Types</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Handle.Internals.html"><span class="hs-identifier">GHC.IO.Handle.Internals</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IO.Handle.Text.html"><span class="hs-identifier">GHC.IO.Handle.Text</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="GHC.IO.BufferedIO.html"><span class="hs-identifier">GHC.IO.BufferedIO</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Buffered</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Base.html"><span class="hs-identifier">GHC.Base</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Exception.html"><span class="hs-identifier">GHC.Exception</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.MVar.html"><span class="hs-identifier">GHC.MVar</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.IORef.html"><span class="hs-identifier">GHC.IORef</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Show.html"><span class="hs-identifier">GHC.Show</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Num.html"><span class="hs-identifier">GHC.Num</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Real.html"><span class="hs-identifier">GHC.Real</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- Closing a handle</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | Computation 'hClose' @hdl@ makes handle @hdl@ closed.  Before the</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- computation finishes, if @hdl@ is writable its buffer is flushed as</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- for 'hFlush'.</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- Performing 'hClose' on a handle that has already been closed has no effect;</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- doing so is not an error.  All other operations on a closed handle will fail.</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- If 'hClose' fails for any reason, any further operations (apart from</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- 'hClose') on the handle will still fail as if @hdl@ had been successfully</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- closed.</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-identifier">hClose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><a name="hClose"><a href="GHC.IO.Handle.html#hClose"><span class="hs-identifier">hClose</span></a></a><span> </span><a name="local-6989586621679307652"><a href="#local-6989586621679307652"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307653"><a href="#local-6989586621679307653"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-90"></a><span>  </span><a name="local-6989586621679307654"><a href="#local-6989586621679307654"><span class="hs-identifier">mb_exc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.html#hClose%27"><span class="hs-identifier hs-var">hClose'</span></a><span> </span><a href="#local-6989586621679307652"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307653"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-91"></a><span>  </span><a href="GHC.IO.Handle.html#hClose_maybethrow"><span class="hs-identifier hs-var">hClose_maybethrow</span></a><span> </span><a href="#local-6989586621679307654"><span class="hs-identifier hs-var">mb_exc</span></a><span> </span><a href="#local-6989586621679307652"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-92"></a><span class="hs-identifier">hClose</span><span> </span><a name="local-6989586621679307655"><a href="#local-6989586621679307655"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307656"><a href="#local-6989586621679307656"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679307657"><a href="#local-6989586621679307657"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-93"></a><span>  </span><a name="local-6989586621679307658"><a href="#local-6989586621679307658"><span class="hs-identifier">excs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.Base.html#mapM"><span class="hs-identifier hs-var">mapM</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#hClose%27"><span class="hs-identifier hs-var">hClose'</span></a><span> </span><a href="#local-6989586621679307655"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679307656"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621679307657"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">]</span><span>
</span><a name="line-94"></a><span>  </span><a href="GHC.IO.Handle.html#hClose_maybethrow"><span class="hs-identifier hs-var">hClose_maybethrow</span></a><span> </span><span class="hs-special">(</span><a href="Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a><span> </span><span class="hs-special">(</span><a href="Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a><span> </span><a href="#local-6989586621679307658"><span class="hs-identifier hs-var">excs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679307655"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-identifier">hClose_maybethrow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.Exception.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="hClose_maybethrow"><a href="GHC.IO.Handle.html#hClose_maybethrow"><span class="hs-identifier">hClose_maybethrow</span></a></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><a name="local-6989586621679307659"><a href="#local-6989586621679307659"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-identifier">hClose_maybethrow</span><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679307660"><a href="#local-6989586621679307660"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679307661"><a href="#local-6989586621679307661"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.html#hClose_rethrow"><span class="hs-identifier hs-var">hClose_rethrow</span></a><span> </span><a href="#local-6989586621679307660"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679307661"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-identifier">hClose_rethrow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.Exception.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><a name="hClose_rethrow"><a href="GHC.IO.Handle.html#hClose_rethrow"><span class="hs-identifier">hClose_rethrow</span></a></a><span> </span><a name="local-6989586621679307662"><a href="#local-6989586621679307662"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679307663"><a href="#local-6989586621679307663"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="GHC.Exception.html#fromException"><span class="hs-identifier hs-var">fromException</span></a><span> </span><a href="#local-6989586621679307662"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-103"></a><span>    </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679307664"><a href="#local-6989586621679307664"><span class="hs-identifier">ioe</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Exception.html#ioError"><span class="hs-identifier hs-var">ioError</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Internals.html#augmentIOError"><span class="hs-identifier hs-var">augmentIOError</span></a><span> </span><a href="#local-6989586621679307664"><span class="hs-identifier hs-var">ioe</span></a><span> </span><span class="hs-string">&quot;hClose&quot;</span><span> </span><a href="#local-6989586621679307663"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="#local-6989586621679307662"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">hClose'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.Exception.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><a name="hClose%27"><a href="GHC.IO.Handle.html#hClose%27"><span class="hs-identifier">hClose'</span></a></a><span> </span><a name="local-6989586621679307665"><a href="#local-6989586621679307665"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679307666"><a href="#local-6989586621679307666"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Internals.html#withHandle%27"><span class="hs-identifier hs-var">withHandle'</span></a><span> </span><span class="hs-string">&quot;hClose&quot;</span><span> </span><a href="#local-6989586621679307665"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307666"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#hClose_help"><span class="hs-identifier hs-var">hClose_help</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- Detecting and changing the size of a file</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">-- | For a handle @hdl@ which attached to a physical file,</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- 'hFileSize' @hdl@ returns the size of that file in 8-bit bytes.</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">hFileSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../integer-gmp-1.0.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a><span>
</span><a name="line-116"></a><a name="hFileSize"><a href="GHC.IO.Handle.html#hFileSize"><span class="hs-identifier">hFileSize</span></a></a><span> </span><a name="local-6989586621679307667"><a href="#local-6989586621679307667"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-117"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hFileSize&quot;</span><span> </span><a href="#local-6989586621679307667"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307668"><a href="#local-6989586621679307668"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-identifier">haDevice</span><span class="hs-glyph">=</span><a name="local-6989586621679307669"><a href="#local-6989586621679307669"><span class="hs-identifier">dev</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307668"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-119"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-120"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_semiclosedHandle"><span class="hs-identifier hs-var">ioe_semiclosedHandle</span></a><span>
</span><a name="line-121"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="GHC.IO.Handle.Internals.html#flushWriteBuffer"><span class="hs-identifier hs-var">flushWriteBuffer</span></a><span> </span><a href="#local-6989586621679307668"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-122"></a><span>              </span><a name="local-6989586621679307670"><a href="#local-6989586621679307670"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Device.html#getSize"><span class="hs-identifier hs-var">IODevice.getSize</span></a><span> </span><a href="#local-6989586621679307669"><span class="hs-identifier hs-var">dev</span></a><span>
</span><a name="line-123"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679307670"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-124"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679307670"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-125"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><a href="GHC.IO.Exception.html#ioException"><span class="hs-identifier hs-var">ioException</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Exception.html#IOError"><span class="hs-identifier hs-var">IOError</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="GHC.IO.Exception.html#InappropriateType"><span class="hs-identifier hs-var">InappropriateType</span></a><span> </span><span class="hs-string">&quot;hFileSize&quot;</span><span>
</span><a name="line-126"></a><span>                                   </span><span class="hs-string">&quot;not a regular file&quot;</span><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- | 'hSetFileSize' @hdl@ @size@ truncates the physical file with handle @hdl@ to @size@ bytes.</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">hSetFileSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../integer-gmp-1.0.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><a name="hSetFileSize"><a href="GHC.IO.Handle.html#hSetFileSize"><span class="hs-identifier">hSetFileSize</span></a></a><span> </span><a name="local-6989586621679307671"><a href="#local-6989586621679307671"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679307672"><a href="#local-6989586621679307672"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-133"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hSetFileSize&quot;</span><span> </span><a href="#local-6989586621679307671"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307673"><a href="#local-6989586621679307673"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-identifier">haDevice</span><span class="hs-glyph">=</span><a name="local-6989586621679307674"><a href="#local-6989586621679307674"><span class="hs-identifier">dev</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307673"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-135"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-136"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_semiclosedHandle"><span class="hs-identifier hs-var">ioe_semiclosedHandle</span></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="GHC.IO.Handle.Internals.html#flushWriteBuffer"><span class="hs-identifier hs-var">flushWriteBuffer</span></a><span> </span><a href="#local-6989586621679307673"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-138"></a><span>              </span><a href="GHC.IO.Device.html#setSize"><span class="hs-identifier hs-var">IODevice.setSize</span></a><span> </span><a href="#local-6989586621679307674"><span class="hs-identifier hs-var">dev</span></a><span> </span><a href="#local-6989586621679307672"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-139"></a><span>              </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- Detecting the End of Input</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- | For a readable handle @hdl@, 'hIsEOF' @hdl@ returns</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- 'True' if no further input can be taken from @hdl@ or for a</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- physical file, if the current I\/O position is equal to the length of</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- the file.  Otherwise, it returns 'False'.</span><span>
</span><a name="line-148"></a><span class="hs-comment">--</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- NOTE: 'hIsEOF' may block, because it has to attempt to read from</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- the stream to determine whether there is any more data to be read.</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">hIsEOF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-153"></a><a name="hIsEOF"><a href="GHC.IO.Handle.html#hIsEOF"><span class="hs-identifier">hIsEOF</span></a></a><span> </span><a name="local-6989586621679307675"><a href="#local-6989586621679307675"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Internals.html#wantReadableHandle_"><span class="hs-identifier hs-var">wantReadableHandle_</span></a><span> </span><span class="hs-string">&quot;hIsEOF&quot;</span><span> </span><a href="#local-6989586621679307675"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>  </span><a name="local-6989586621679307689"><a href="#local-6989586621679307689"><span class="hs-identifier">cbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307681"><span class="hs-identifier hs-var">haCharBuffer</span></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Buffer.html#isEmptyBuffer"><span class="hs-identifier hs-var">isEmptyBuffer</span></a><span> </span><a href="#local-6989586621679307689"><span class="hs-identifier hs-var">cbuf</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>  </span><a name="local-6989586621679307690"><a href="#local-6989586621679307690"><span class="hs-identifier">bbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307678"><span class="hs-identifier hs-var">haByteBuffer</span></a><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Buffer.html#isEmptyBuffer"><span class="hs-identifier hs-var">isEmptyBuffer</span></a><span> </span><a href="#local-6989586621679307690"><span class="hs-identifier hs-var">bbuf</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-comment">-- NB. do no decoding, just fill the byte buffer; see #3808</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679307691"><a href="#local-6989586621679307691"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679307692"><a href="#local-6989586621679307692"><span class="hs-identifier">bbuf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.BufferedIO.html#fillReadBuffer"><span class="hs-identifier hs-var">Buffered.fillReadBuffer</span></a><span> </span><a href="#local-6989586621679307676"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="#local-6989586621679307690"><span class="hs-identifier hs-var">bbuf</span></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679307691"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-164"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-165"></a><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621679307678"><span class="hs-identifier hs-var">haByteBuffer</span></a><span> </span><a href="#local-6989586621679307692"><span class="hs-identifier hs-var">bbuf'</span></a><span>
</span><a name="line-166"></a><span>             </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- isEOF</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">-- | The computation 'isEOF' is identical to 'hIsEOF',</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- except that it works only on 'stdin'.</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">isEOF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-175"></a><a name="isEOF"><a href="GHC.IO.Handle.html#isEOF"><span class="hs-identifier">isEOF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.html#hIsEOF"><span class="hs-identifier hs-var">hIsEOF</span></a><span> </span><a href="GHC.IO.Handle.FD.html#stdin"><span class="hs-identifier hs-var">stdin</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- Looking ahead</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- | Computation 'hLookAhead' returns the next character from the handle</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- without removing it from the input buffer, blocking until a character</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- is available.</span><span>
</span><a name="line-183"></a><span class="hs-comment">--</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">--  * 'isEOFError' if the end of file has been reached.</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-identifier">hLookAhead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Char"><span class="hs-identifier hs-type">Char</span></a><span>
</span><a name="line-189"></a><a name="hLookAhead"><a href="GHC.IO.Handle.html#hLookAhead"><span class="hs-identifier">hLookAhead</span></a></a><span> </span><a name="local-6989586621679307693"><a href="#local-6989586621679307693"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-190"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#wantReadableHandle_"><span class="hs-identifier hs-var">wantReadableHandle_</span></a><span> </span><span class="hs-string">&quot;hLookAhead&quot;</span><span>  </span><a href="#local-6989586621679307693"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#hLookAhead_"><span class="hs-identifier hs-var">hLookAhead_</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- Buffering Operations</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- Three kinds of buffering are supported: line-buffering,</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- block-buffering or no-buffering.  See GHC.IO.Handle for definition and</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- further explanation of what the type represent.</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- | Computation 'hSetBuffering' @hdl mode@ sets the mode of buffering for</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- handle @hdl@ on subsequent reads and writes.</span><span>
</span><a name="line-201"></a><span class="hs-comment">--</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- If the buffer mode is changed from 'BlockBuffering' or</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- 'LineBuffering' to 'NoBuffering', then</span><span>
</span><a name="line-204"></a><span class="hs-comment">--</span><span>
</span><a name="line-205"></a><span class="hs-comment">--  * if @hdl@ is writable, the buffer is flushed as for 'hFlush';</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">--  * if @hdl@ is not writable, the contents of the buffer is discarded.</span><span>
</span><a name="line-208"></a><span class="hs-comment">--</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">--  * 'isPermissionError' if the handle has already been used for reading</span><span>
</span><a name="line-212"></a><span class="hs-comment">--    or writing and the implementation does not allow the buffering mode</span><span>
</span><a name="line-213"></a><span class="hs-comment">--    to be changed.</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">hSetBuffering</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#BufferMode"><span class="hs-identifier hs-type">BufferMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><a name="hSetBuffering"><a href="GHC.IO.Handle.html#hSetBuffering"><span class="hs-identifier">hSetBuffering</span></a></a><span> </span><a name="local-6989586621679307694"><a href="#local-6989586621679307694"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679307695"><a href="#local-6989586621679307695"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withAllHandles__"><span class="hs-identifier hs-var">withAllHandles__</span></a><span> </span><span class="hs-string">&quot;hSetBuffering&quot;</span><span> </span><a href="#local-6989586621679307694"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307696"><a href="#local-6989586621679307696"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307698"><span class="hs-identifier hs-var">haType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>    </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-220"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-221"></a><span>         </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679307695"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><a href="#local-6989586621679307700"><span class="hs-identifier hs-var">haBufferMode</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679307696"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span>         </span><span class="hs-comment">-- See [note Buffer Sizing] in GHC.IO.Handle.Types</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span>          </span><span class="hs-comment">-- check for errors:</span><span>
</span><a name="line-226"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307695"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-227"></a><span>              </span><a href="GHC.IO.Handle.Types.html#BlockBuffering"><span class="hs-identifier hs-var">BlockBuffering</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679307710"><a href="#local-6989586621679307710"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679307710"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_bufsiz"><span class="hs-identifier hs-var">ioe_bufsiz</span></a><span> </span><a href="#local-6989586621679307710"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-228"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span>          </span><span class="hs-comment">-- for input terminals we need to put the terminal into</span><span>
</span><a name="line-231"></a><span>          </span><span class="hs-comment">-- cooked or raw mode depending on the type of buffering.</span><span>
</span><a name="line-232"></a><span>          </span><a name="local-6989586621679307711"><a href="#local-6989586621679307711"><span class="hs-identifier">is_tty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Device.html#isTerminal"><span class="hs-identifier hs-var">IODevice.isTerminal</span></a><span> </span><a href="#local-6989586621679307697"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-233"></a><span>          </span><a href="GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679307711"><span class="hs-identifier hs-var">is_tty</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="GHC.IO.Handle.Types.html#isReadableHandleType"><span class="hs-identifier hs-var">isReadableHandleType</span></a><span> </span><a href="#local-6989586621679307698"><span class="hs-identifier hs-var">haType</span></a><span class="hs-special">)</span><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-234"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307695"><span class="hs-identifier hs-var">mode</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-235"></a><span class="hs-cpp">#if !defined(mingw32_HOST_OS)
</span><span>        </span><span class="hs-comment">-- 'raw' mode under win32 is a bit too specialised (and troublesome</span><span>
</span><a name="line-237"></a><span>        </span><span class="hs-comment">-- for most common uses), so simply disable its use here.</span><span>
</span><a name="line-238"></a><span>                  </span><a href="GHC.IO.Handle.Types.html#NoBuffering"><span class="hs-identifier hs-var">NoBuffering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#setRaw"><span class="hs-identifier hs-var">IODevice.setRaw</span></a><span> </span><a href="#local-6989586621679307697"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-239"></a><span class="hs-cpp">#else
</span><span>                  </span><span class="hs-identifier">NoBuffering</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span class="hs-cpp">#endif
</span><span>                  </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#setRaw"><span class="hs-identifier hs-var">IODevice.setRaw</span></a><span> </span><a href="#local-6989586621679307697"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span>          </span><span class="hs-comment">-- throw away spare buffers, they might be the wrong size</span><span>
</span><a name="line-245"></a><span>          </span><a href="GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621679307703"><span class="hs-identifier hs-var">haBuffers</span></a><span> </span><a href="GHC.IO.Handle.Types.html#BufferListNil"><span class="hs-identifier hs-var">BufferListNil</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>          </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">haBufferMode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307695"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">,</span><span class="hs-glyph">..</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- hSetEncoding</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | The action 'hSetEncoding' @hdl@ @encoding@ changes the text encoding</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- for the handle @hdl@ to @encoding@.  The default encoding when a 'Handle' is</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- created is 'localeEncoding', namely the default encoding for the current</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- locale.</span><span>
</span><a name="line-256"></a><span class="hs-comment">--</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- To create a 'Handle' with no encoding at all, use 'openBinaryFile'.  To</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- stop further encoding or decoding on an existing 'Handle', use</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- 'hSetBinaryMode'.</span><span>
</span><a name="line-260"></a><span class="hs-comment">--</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- 'hSetEncoding' may need to flush buffered data in order to change</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- the encoding.</span><span>
</span><a name="line-263"></a><span class="hs-comment">--</span><span>
</span><a name="line-264"></a><span class="hs-identifier">hSetEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Encoding.Types.html#TextEncoding"><span class="hs-identifier hs-type">TextEncoding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><a name="hSetEncoding"><a href="GHC.IO.Handle.html#hSetEncoding"><span class="hs-identifier">hSetEncoding</span></a></a><span> </span><a name="local-6989586621679307712"><a href="#local-6989586621679307712"><span class="hs-identifier">hdl</span></a></a><span> </span><a name="local-6989586621679307713"><a href="#local-6989586621679307713"><span class="hs-identifier">encoding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-266"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withAllHandles__"><span class="hs-identifier hs-var">withAllHandles__</span></a><span> </span><span class="hs-string">&quot;hSetEncoding&quot;</span><span> </span><a href="#local-6989586621679307712"><span class="hs-identifier hs-var">hdl</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307714"><a href="#local-6989586621679307714"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-267"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#flushCharBuffer"><span class="hs-identifier hs-var">flushCharBuffer</span></a><span> </span><a href="#local-6989586621679307714"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-268"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#closeTextCodecs"><span class="hs-identifier hs-var">closeTextCodecs</span></a><span> </span><a href="#local-6989586621679307714"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-269"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#openTextEncoding"><span class="hs-identifier hs-var">openTextEncoding</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679307713"><span class="hs-identifier hs-var">encoding</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679307716"><span class="hs-identifier hs-var">haType</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307728"><a href="#local-6989586621679307728"><span class="hs-identifier">mb_encoder</span></a></a><span> </span><a name="local-6989586621679307729"><a href="#local-6989586621679307729"><span class="hs-identifier">mb_decoder</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-270"></a><span>    </span><a name="local-6989586621679307730"><a href="#local-6989586621679307730"><span class="hs-identifier">bbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307717"><span class="hs-identifier hs-var">haByteBuffer</span></a><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621679307731"><a href="#local-6989586621679307731"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Err.html#errorWithoutStackTrace"><span class="hs-identifier hs-var">errorWithoutStackTrace</span></a><span> </span><span class="hs-string">&quot;last_decode&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>    </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">haLastDecode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307731"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">,</span><span>
</span><a name="line-273"></a><span>                      </span><span class="hs-identifier">haDecoder</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307729"><span class="hs-identifier hs-var">mb_decoder</span></a><span class="hs-special">,</span><span>
</span><a name="line-274"></a><span>                      </span><span class="hs-identifier">haEncoder</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307728"><span class="hs-identifier hs-var">mb_encoder</span></a><span class="hs-special">,</span><span>
</span><a name="line-275"></a><span>                      </span><span class="hs-identifier">haCodec</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679307713"><span class="hs-identifier hs-var">encoding</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-- | Return the current 'TextEncoding' for the specified 'Handle', or</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- 'Nothing' if the 'Handle' is in binary mode.</span><span>
</span><a name="line-279"></a><span class="hs-comment">--</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- Note that the 'TextEncoding' remembers nothing about the state of</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- the encoder/decoder in use on this 'Handle'.  For example, if the</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- encoding in use is UTF-16, then using 'hGetEncoding' and</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- 'hSetEncoding' to save and restore the encoding may result in an</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- extra byte-order-mark being written to the file.</span><span>
</span><a name="line-285"></a><span class="hs-comment">--</span><span>
</span><a name="line-286"></a><span class="hs-identifier">hGetEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.IO.Encoding.Types.html#TextEncoding"><span class="hs-identifier hs-type">TextEncoding</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><a name="hGetEncoding"><a href="GHC.IO.Handle.html#hGetEncoding"><span class="hs-identifier">hGetEncoding</span></a></a><span> </span><a name="local-6989586621679307732"><a href="#local-6989586621679307732"><span class="hs-identifier">hdl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-288"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hGetEncoding&quot;</span><span> </span><a href="#local-6989586621679307732"><span class="hs-identifier hs-var">hdl</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307733"><a href="#local-6989586621679307733"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679307743"><span class="hs-identifier hs-var">haCodec</span></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- hFlush</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | The action 'hFlush' @hdl@ causes any items buffered for output</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- in handle @hdl@ to be sent immediately to the operating system.</span><span>
</span><a name="line-295"></a><span class="hs-comment">--</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-297"></a><span class="hs-comment">--</span><span>
</span><a name="line-298"></a><span class="hs-comment">--  * 'isFullError' if the device is full;</span><span>
</span><a name="line-299"></a><span class="hs-comment">--</span><span>
</span><a name="line-300"></a><span class="hs-comment">--  * 'isPermissionError' if a system resource limit would be exceeded.</span><span>
</span><a name="line-301"></a><span class="hs-comment">--    It is unspecified whether the characters in the buffer are discarded</span><span>
</span><a name="line-302"></a><span class="hs-comment">--    or retained under these circumstances.</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-identifier">hFlush</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><a name="hFlush"><a href="GHC.IO.Handle.html#hFlush"><span class="hs-identifier">hFlush</span></a></a><span> </span><a name="local-6989586621679307747"><a href="#local-6989586621679307747"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Internals.html#wantWritableHandle"><span class="hs-identifier hs-var">wantWritableHandle</span></a><span> </span><span class="hs-string">&quot;hFlush&quot;</span><span> </span><a href="#local-6989586621679307747"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#flushWriteBuffer"><span class="hs-identifier hs-var">flushWriteBuffer</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- | The action 'hFlushAll' @hdl@ flushes all buffered data in @hdl@,</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- including any buffered read data.  Buffered read data is flushed</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- by seeking the file position back to the point before the bufferred</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- data was read, and hence only works if @hdl@ is seekable (see</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- 'hIsSeekable').</span><span>
</span><a name="line-312"></a><span class="hs-comment">--</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-314"></a><span class="hs-comment">--</span><span>
</span><a name="line-315"></a><span class="hs-comment">--  * 'isFullError' if the device is full;</span><span>
</span><a name="line-316"></a><span class="hs-comment">--</span><span>
</span><a name="line-317"></a><span class="hs-comment">--  * 'isPermissionError' if a system resource limit would be exceeded.</span><span>
</span><a name="line-318"></a><span class="hs-comment">--    It is unspecified whether the characters in the buffer are discarded</span><span>
</span><a name="line-319"></a><span class="hs-comment">--    or retained under these circumstances;</span><span>
</span><a name="line-320"></a><span class="hs-comment">--</span><span>
</span><a name="line-321"></a><span class="hs-comment">--  * 'isIllegalOperation' if @hdl@ has buffered read data, and is not</span><span>
</span><a name="line-322"></a><span class="hs-comment">--    seekable.</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-identifier">hFlushAll</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><a name="hFlushAll"><a href="GHC.IO.Handle.html#hFlushAll"><span class="hs-identifier">hFlushAll</span></a></a><span> </span><a name="local-6989586621679307748"><a href="#local-6989586621679307748"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hFlushAll&quot;</span><span> </span><a href="#local-6989586621679307748"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#flushBuffer"><span class="hs-identifier hs-var">flushBuffer</span></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- Repositioning Handles</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span class="hs-keyword">data</span><span> </span><a name="HandlePosn"><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier">HandlePosn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HandlePosn"><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier">HandlePosn</span></a></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><a href="GHC.IO.Handle.html#HandlePosition"><span class="hs-identifier hs-type">HandlePosition</span></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | @since 4.1.0.0</span><span>
</span><a name="line-333"></a><span class="hs-keyword">instance</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a><span> </span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-type">HandlePosn</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-334"></a><span>    </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-var">HandlePosn</span></a><span> </span><a name="local-6989586621679307646"><a href="#local-6989586621679307646"><span class="hs-identifier">h1</span></a></a><span> </span><a name="local-6989586621679307647"><a href="#local-6989586621679307647"><span class="hs-identifier">p1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-3458764513820541095"><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator">==</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-var">HandlePosn</span></a><span> </span><a name="local-6989586621679307648"><a href="#local-6989586621679307648"><span class="hs-identifier">h2</span></a></a><span> </span><a name="local-6989586621679307649"><a href="#local-6989586621679307649"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307647"><span class="hs-identifier hs-var">p1</span></a><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><a href="#local-6989586621679307649"><span class="hs-identifier hs-var">p2</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="#local-6989586621679307646"><span class="hs-identifier hs-var">h1</span></a><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><a href="#local-6989586621679307648"><span class="hs-identifier hs-var">h2</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- | @since 4.1.0.0</span><span>
</span><a name="line-337"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span> </span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-type">HandlePosn</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-338"></a><span>   </span><a name="local-8214565720323806416"><a href="GHC.Show.html#showsPrec"><span class="hs-identifier">showsPrec</span></a></a><span> </span><a name="local-6989586621679307643"><a href="#local-6989586621679307643"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-var">HandlePosn</span></a><span> </span><a name="local-6989586621679307644"><a href="#local-6989586621679307644"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679307645"><a href="#local-6989586621679307645"><span class="hs-identifier">pos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-339"></a><span>        </span><a href="GHC.Show.html#showsPrec"><span class="hs-identifier hs-var">showsPrec</span></a><span> </span><a href="#local-6989586621679307643"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679307644"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot; at position &quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679307645"><span class="hs-identifier hs-var">pos</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span>  </span><span class="hs-comment">-- HandlePosition is the Haskell equivalent of POSIX' off_t.</span><span>
</span><a name="line-342"></a><span>  </span><span class="hs-comment">-- We represent it as an Integer on the Haskell side, but</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-comment">-- cheat slightly in that hGetPosn calls upon a C helper</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-comment">-- that reports the position back via (merely) an Int.</span><span>
</span><a name="line-345"></a><span class="hs-keyword">type</span><span> </span><a name="HandlePosition"><a href="GHC.IO.Handle.html#HandlePosition"><span class="hs-identifier">HandlePosition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../integer-gmp-1.0.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span class="hs-comment">-- | Computation 'hGetPosn' @hdl@ returns the current I\/O position of</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- @hdl@ as a value of the abstract type 'HandlePosn'.</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-identifier">hGetPosn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-type">HandlePosn</span></a><span>
</span><a name="line-351"></a><a name="hGetPosn"><a href="GHC.IO.Handle.html#hGetPosn"><span class="hs-identifier">hGetPosn</span></a></a><span> </span><a name="local-6989586621679307749"><a href="#local-6989586621679307749"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-352"></a><span>    </span><a name="local-6989586621679307750"><a href="#local-6989586621679307750"><span class="hs-identifier">posn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.html#hTell"><span class="hs-identifier hs-var">hTell</span></a><span> </span><a href="#local-6989586621679307749"><span class="hs-identifier hs-var">handle</span></a><span>
</span><a name="line-353"></a><span>    </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-var">HandlePosn</span></a><span> </span><a href="#local-6989586621679307749"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="#local-6989586621679307750"><span class="hs-identifier hs-var">posn</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">-- | If a call to 'hGetPosn' @hdl@ returns a position @p@,</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- then computation 'hSetPosn' @p@ sets the position of @hdl@</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- to the position it held at the time of the call to 'hGetPosn'.</span><span>
</span><a name="line-358"></a><span class="hs-comment">--</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-360"></a><span class="hs-comment">--</span><span>
</span><a name="line-361"></a><span class="hs-comment">--  * 'isPermissionError' if a system resource limit would be exceeded.</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-identifier">hSetPosn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-type">HandlePosn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-364"></a><a name="hSetPosn"><a href="GHC.IO.Handle.html#hSetPosn"><span class="hs-identifier">hSetPosn</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.html#HandlePosn"><span class="hs-identifier hs-var">HandlePosn</span></a><span> </span><a name="local-6989586621679307751"><a href="#local-6989586621679307751"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679307752"><a href="#local-6989586621679307752"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.html#hSeek"><span class="hs-identifier hs-var">hSeek</span></a><span> </span><a href="#local-6989586621679307751"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="GHC.IO.Device.html#AbsoluteSeek"><span class="hs-identifier hs-var">AbsoluteSeek</span></a><span> </span><a href="#local-6989586621679307752"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- hSeek</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">{- Note:
 - when seeking using `SeekFromEnd', positive offsets (&gt;=0) means
   seeking at or past EOF.

 - we possibly deviate from the report on the issue of seeking within
   the buffer and whether to flush it or not.  The report isn't exactly
   clear here.
-}</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- | Computation 'hSeek' @hdl mode i@ sets the position of handle</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- @hdl@ depending on @mode@.</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- The offset @i@ is given in terms of 8-bit bytes.</span><span>
</span><a name="line-381"></a><span class="hs-comment">--</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- If @hdl@ is block- or line-buffered, then seeking to a position which is not</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- in the current buffer will first cause any items in the output buffer to be</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- written to the device, and then cause the input buffer to be discarded.</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- Some handles may not be seekable (see 'hIsSeekable'), or only support a</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- subset of the possible positioning operations (for instance, it may only</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- be possible to seek to the end of a tape, or to a positive offset from</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- the beginning or current position).</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- It is not possible to set a negative I\/O position, or for</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- a physical file, an I\/O position beyond the current end-of-file.</span><span>
</span><a name="line-391"></a><span class="hs-comment">--</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-393"></a><span class="hs-comment">--</span><span>
</span><a name="line-394"></a><span class="hs-comment">--  * 'isIllegalOperationError' if the Handle is not seekable, or does</span><span>
</span><a name="line-395"></a><span class="hs-comment">--     not support the requested seek mode.</span><span>
</span><a name="line-396"></a><span class="hs-comment">--</span><span>
</span><a name="line-397"></a><span class="hs-comment">--  * 'isPermissionError' if a system resource limit would be exceeded.</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">hSeek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#SeekMode"><span class="hs-identifier hs-type">SeekMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../integer-gmp-1.0.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="hSeek"><a href="GHC.IO.Handle.html#hSeek"><span class="hs-identifier">hSeek</span></a></a><span> </span><a name="local-6989586621679307753"><a href="#local-6989586621679307753"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679307754"><a href="#local-6989586621679307754"><span class="hs-identifier">mode</span></a></a><span> </span><a name="local-6989586621679307755"><a href="#local-6989586621679307755"><span class="hs-identifier">offset</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-401"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#wantSeekableHandle"><span class="hs-identifier hs-var">wantSeekableHandle</span></a><span> </span><span class="hs-string">&quot;hSeek&quot;</span><span> </span><a href="#local-6989586621679307753"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307756"><a href="#local-6989586621679307756"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-402"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#debugIO"><span class="hs-identifier hs-var">debugIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;hSeek &quot;</span><span> </span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679307754"><span class="hs-identifier hs-var">mode</span></a><span class="hs-special">,</span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>    </span><a name="local-6989586621679307770"><a href="#local-6989586621679307770"><span class="hs-identifier">buf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307762"><span class="hs-identifier hs-var">haCharBuffer</span></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="GHC.IO.Buffer.html#isWriteBuffer"><span class="hs-identifier hs-var">isWriteBuffer</span></a><span> </span><a href="#local-6989586621679307770"><span class="hs-identifier hs-var">buf</span></a><span>
</span><a name="line-406"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="GHC.IO.Handle.Internals.html#flushWriteBuffer"><span class="hs-identifier hs-var">flushWriteBuffer</span></a><span> </span><a href="#local-6989586621679307756"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-407"></a><span>                </span><a href="GHC.IO.Device.html#seek"><span class="hs-identifier hs-var">IODevice.seek</span></a><span> </span><a href="#local-6989586621679307757"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="#local-6989586621679307754"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-408"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679307771"><a href="#local-6989586621679307771"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bufL</span><span> </span><a href="#local-6989586621679307770"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621679307772"><a href="#local-6989586621679307772"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bufR</span><span> </span><a href="#local-6989586621679307770"><span class="hs-identifier hs-var">buf</span></a><span>
</span><a name="line-411"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679307754"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a><span> </span><a href="GHC.IO.Device.html#RelativeSeek"><span class="hs-identifier hs-var">RelativeSeek</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><a href="#local-6989586621679307765"><span class="hs-identifier hs-var">haDecoder</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a><span>
</span><a name="line-412"></a><span>       </span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3E%3D"><span class="hs-operator hs-var">&gt;=</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a><span> </span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679307772"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679307771"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621679307762"><span class="hs-identifier hs-var">haCharBuffer</span></a><span> </span><a href="#local-6989586621679307770"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">bufL</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307771"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-414"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#flushCharReadBuffer"><span class="hs-identifier hs-var">flushCharReadBuffer</span></a><span> </span><a href="#local-6989586621679307756"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-417"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#flushByteReadBuffer"><span class="hs-identifier hs-var">flushByteReadBuffer</span></a><span> </span><a href="#local-6989586621679307756"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-418"></a><span>    </span><a href="GHC.IO.Device.html#seek"><span class="hs-identifier hs-var">IODevice.seek</span></a><span> </span><a href="#local-6989586621679307757"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="#local-6989586621679307754"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679307755"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-- | Computation 'hTell' @hdl@ returns the current position of the</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- handle @hdl@, as the number of bytes from the beginning of</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- the file.  The value returned may be subsequently passed to</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- 'hSeek' to reposition the handle to the current position.</span><span>
</span><a name="line-425"></a><span class="hs-comment">--</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- This operation may fail with:</span><span>
</span><a name="line-427"></a><span class="hs-comment">--</span><span>
</span><a name="line-428"></a><span class="hs-comment">--  * 'isIllegalOperationError' if the Handle is not seekable.</span><span>
</span><a name="line-429"></a><span class="hs-comment">--</span><span>
</span><a name="line-430"></a><span class="hs-identifier">hTell</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../integer-gmp-1.0.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Integer.Type.html#Integer"><span class="hs-identifier hs-type">Integer</span></a><span>
</span><a name="line-431"></a><a name="hTell"><a href="GHC.IO.Handle.html#hTell"><span class="hs-identifier">hTell</span></a></a><span> </span><a name="local-6989586621679307773"><a href="#local-6989586621679307773"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-432"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#wantSeekableHandle"><span class="hs-identifier hs-var">wantSeekableHandle</span></a><span> </span><span class="hs-string">&quot;hGetPosn&quot;</span><span> </span><a href="#local-6989586621679307773"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307774"><a href="#local-6989586621679307774"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span>      </span><a name="local-6989586621679307788"><a href="#local-6989586621679307788"><span class="hs-identifier">posn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Device.html#tell"><span class="hs-identifier hs-var">IODevice.tell</span></a><span> </span><a href="#local-6989586621679307775"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span>      </span><span class="hs-comment">-- we can't tell the real byte offset if there are buffered</span><span>
</span><a name="line-437"></a><span>      </span><span class="hs-comment">-- Chars, so must flush first:</span><span>
</span><a name="line-438"></a><span>      </span><a href="GHC.IO.Handle.Internals.html#flushCharBuffer"><span class="hs-identifier hs-var">flushCharBuffer</span></a><span> </span><a href="#local-6989586621679307774"><span class="hs-identifier hs-var">handle_</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span>      </span><a name="local-6989586621679307789"><a href="#local-6989586621679307789"><span class="hs-identifier">bbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307777"><span class="hs-identifier hs-var">haByteBuffer</span></a><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679307790"><a href="#local-6989586621679307790"><span class="hs-identifier">real_posn</span></a></a><span>
</span><a name="line-443"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="GHC.IO.Buffer.html#isWriteBuffer"><span class="hs-identifier hs-var">isWriteBuffer</span></a><span> </span><a href="#local-6989586621679307789"><span class="hs-identifier hs-var">bbuf</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307788"><span class="hs-identifier hs-var">posn</span></a><span> </span><a href="GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span> </span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Buffer.html#bufferElems"><span class="hs-identifier hs-var">bufferElems</span></a><span> </span><a href="#local-6989586621679307789"><span class="hs-identifier hs-var">bbuf</span></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307788"><span class="hs-identifier hs-var">posn</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Buffer.html#bufferElems"><span class="hs-identifier hs-var">bufferElems</span></a><span> </span><a href="#local-6989586621679307789"><span class="hs-identifier hs-var">bbuf</span></a><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span>      </span><a name="local-6989586621679307791"><a href="#local-6989586621679307791"><span class="hs-identifier">cbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307780"><span class="hs-identifier hs-var">haCharBuffer</span></a><span>
</span><a name="line-447"></a><span>      </span><a href="GHC.IO.Handle.Internals.html#debugIO"><span class="hs-identifier hs-var">debugIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\nhGetPosn: (posn, real_posn) = &quot;</span><span> </span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679307788"><span class="hs-identifier hs-var">posn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679307790"><span class="hs-identifier hs-var">real_posn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>      </span><a href="GHC.IO.Handle.Internals.html#debugIO"><span class="hs-identifier hs-var">debugIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;   cbuf: &quot;</span><span> </span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a><span> </span><a href="#local-6989586621679307791"><span class="hs-identifier hs-var">cbuf</span></a><span> </span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-449"></a><span>            </span><span class="hs-string">&quot;   bbuf: &quot;</span><span> </span><a href="GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="GHC.IO.Buffer.html#summaryBuffer"><span class="hs-identifier hs-var">summaryBuffer</span></a><span> </span><a href="#local-6989586621679307789"><span class="hs-identifier hs-var">bbuf</span></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span>      </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679307790"><span class="hs-identifier hs-var">real_posn</span></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- Handle Properties</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-comment">-- A number of operations return information about the properties of a</span><span>
</span><a name="line-457"></a><span class="hs-comment">-- handle.  Each of these operations returns `True' if the handle has</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- the specified property, and `False' otherwise.</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-identifier">hIsOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-461"></a><a name="hIsOpen"><a href="GHC.IO.Handle.html#hIsOpen"><span class="hs-identifier">hIsOpen</span></a></a><span> </span><a name="local-6989586621679307792"><a href="#local-6989586621679307792"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-462"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsOpen&quot;</span><span> </span><a href="#local-6989586621679307792"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307793"><a href="#local-6989586621679307793"><span class="hs-identifier">handle_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-463"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307793"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-464"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-465"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-466"></a><span>      </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-identifier">hIsClosed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-469"></a><a name="hIsClosed"><a href="GHC.IO.Handle.html#hIsClosed"><span class="hs-identifier">hIsClosed</span></a></a><span> </span><a name="local-6989586621679307794"><a href="#local-6989586621679307794"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-470"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsClosed&quot;</span><span> </span><a href="#local-6989586621679307794"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307795"><a href="#local-6989586621679307795"><span class="hs-identifier">handle_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307795"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-472"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-473"></a><span>      </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span class="hs-comment">{- not defined, nor exported, but mentioned
   here for documentation purposes:

    hSemiClosed :: Handle -&gt; IO Bool
    hSemiClosed h = do
       ho &lt;- hIsOpen h
       hc &lt;- hIsClosed h
       return (not (ho || hc))
-}</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-identifier">hIsReadable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-486"></a><a name="hIsReadable"><a href="GHC.IO.Handle.html#hIsReadable"><span class="hs-identifier">hIsReadable</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-487"></a><span class="hs-identifier">hIsReadable</span><span> </span><a name="local-6989586621679307796"><a href="#local-6989586621679307796"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-488"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsReadable&quot;</span><span> </span><a href="#local-6989586621679307796"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307797"><a href="#local-6989586621679307797"><span class="hs-identifier">handle_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-489"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307797"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-490"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-491"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_semiclosedHandle"><span class="hs-identifier hs-var">ioe_semiclosedHandle</span></a><span>
</span><a name="line-492"></a><span>      </span><a name="local-6989586621679307798"><a href="#local-6989586621679307798"><span class="hs-identifier">htype</span></a></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#isReadableHandleType"><span class="hs-identifier hs-var">isReadableHandleType</span></a><span> </span><a href="#local-6989586621679307798"><span class="hs-identifier hs-var">htype</span></a><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-identifier">hIsWritable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-495"></a><a name="hIsWritable"><a href="GHC.IO.Handle.html#hIsWritable"><span class="hs-identifier">hIsWritable</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span>
</span><a name="line-496"></a><span class="hs-identifier">hIsWritable</span><span> </span><a name="local-6989586621679307799"><a href="#local-6989586621679307799"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-497"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsWritable&quot;</span><span> </span><a href="#local-6989586621679307799"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307800"><a href="#local-6989586621679307800"><span class="hs-identifier">handle_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307800"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-499"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-500"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_semiclosedHandle"><span class="hs-identifier hs-var">ioe_semiclosedHandle</span></a><span>
</span><a name="line-501"></a><span>      </span><a name="local-6989586621679307801"><a href="#local-6989586621679307801"><span class="hs-identifier">htype</span></a></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#isWritableHandleType"><span class="hs-identifier hs-var">isWritableHandleType</span></a><span> </span><a href="#local-6989586621679307801"><span class="hs-identifier hs-var">htype</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span class="hs-comment">-- | Computation 'hGetBuffering' @hdl@ returns the current buffering mode</span><span>
</span><a name="line-504"></a><span class="hs-comment">-- for @hdl@.</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-identifier">hGetBuffering</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.Types.html#BufferMode"><span class="hs-identifier hs-type">BufferMode</span></a><span>
</span><a name="line-507"></a><a name="hGetBuffering"><a href="GHC.IO.Handle.html#hGetBuffering"><span class="hs-identifier">hGetBuffering</span></a></a><span> </span><a name="local-6989586621679307802"><a href="#local-6989586621679307802"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-508"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hGetBuffering&quot;</span><span> </span><a href="#local-6989586621679307802"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307803"><a href="#local-6989586621679307803"><span class="hs-identifier">handle_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-509"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679307803"><span class="hs-identifier hs-var">handle_</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-510"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-511"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-512"></a><span>           </span><span class="hs-comment">-- We're being non-standard here, and allow the buffering</span><span>
</span><a name="line-513"></a><span>           </span><span class="hs-comment">-- of a semi-closed handle to be queried.   -- sof 6/98</span><span>
</span><a name="line-514"></a><span>          </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haBufferMode</span><span> </span><a href="#local-6989586621679307803"><span class="hs-identifier hs-var">handle_</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- could be stricter..</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">hIsSeekable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-517"></a><a name="hIsSeekable"><a href="GHC.IO.Handle.html#hIsSeekable"><span class="hs-identifier">hIsSeekable</span></a></a><span> </span><a name="local-6989586621679307804"><a href="#local-6989586621679307804"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-518"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsSeekable&quot;</span><span> </span><a href="#local-6989586621679307804"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307805"><a href="#local-6989586621679307805"><span class="hs-identifier">handle_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-519"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307807"><span class="hs-identifier hs-var">haType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-520"></a><span>      </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-521"></a><span>      </span><a href="GHC.IO.Handle.Types.html#SemiClosedHandle"><span class="hs-identifier hs-var">SemiClosedHandle</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_semiclosedHandle"><span class="hs-identifier hs-var">ioe_semiclosedHandle</span></a><span>
</span><a name="line-522"></a><span>      </span><a href="GHC.IO.Handle.Types.html#AppendHandle"><span class="hs-identifier hs-var">AppendHandle</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-523"></a><span>      </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#isSeekable"><span class="hs-identifier hs-var">IODevice.isSeekable</span></a><span> </span><a href="#local-6989586621679307806"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-526"></a><span class="hs-comment">-- Changing echo status</span><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-comment">-- | Set the echoing status of a handle connected to a terminal.</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-identifier">hSetEcho</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><a name="hSetEcho"><a href="GHC.IO.Handle.html#hSetEcho"><span class="hs-identifier">hSetEcho</span></a></a><span> </span><a name="local-6989586621679307819"><a href="#local-6989586621679307819"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679307820"><a href="#local-6989586621679307820"><span class="hs-identifier">on</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-532"></a><span>    </span><a name="local-6989586621679307821"><a href="#local-6989586621679307821"><span class="hs-identifier">isT</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.html#hIsTerminalDevice"><span class="hs-identifier hs-var">hIsTerminalDevice</span></a><span> </span><a href="#local-6989586621679307819"><span class="hs-identifier hs-var">handle</span></a><span>
</span><a name="line-533"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a><span> </span><a href="#local-6989586621679307821"><span class="hs-identifier hs-var">isT</span></a><span>
</span><a name="line-534"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>     </span><span class="hs-keyword">else</span><span>
</span><a name="line-536"></a><span>      </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hSetEcho&quot;</span><span> </span><a href="#local-6989586621679307819"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-537"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307823"><span class="hs-identifier hs-var">haType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-538"></a><span>         </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-539"></a><span>         </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#setEcho"><span class="hs-identifier hs-var">IODevice.setEcho</span></a><span> </span><a href="#local-6989586621679307822"><span class="hs-identifier hs-var">haDevice</span></a><span> </span><a href="#local-6989586621679307820"><span class="hs-identifier hs-var">on</span></a><span>
</span><a name="line-540"></a><span>
</span><a name="line-541"></a><span class="hs-comment">-- | Get the echoing status of a handle connected to a terminal.</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-identifier">hGetEcho</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-544"></a><a name="hGetEcho"><a href="GHC.IO.Handle.html#hGetEcho"><span class="hs-identifier">hGetEcho</span></a></a><span> </span><a name="local-6989586621679307835"><a href="#local-6989586621679307835"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-545"></a><span>    </span><a name="local-6989586621679307836"><a href="#local-6989586621679307836"><span class="hs-identifier">isT</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.html#hIsTerminalDevice"><span class="hs-identifier hs-var">hIsTerminalDevice</span></a><span> </span><a href="#local-6989586621679307835"><span class="hs-identifier hs-var">handle</span></a><span>
</span><a name="line-546"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a><span> </span><a href="#local-6989586621679307836"><span class="hs-identifier hs-var">isT</span></a><span>
</span><a name="line-547"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span>
</span><a name="line-548"></a><span>     </span><span class="hs-keyword">else</span><span>
</span><a name="line-549"></a><span>       </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hGetEcho&quot;</span><span> </span><a href="#local-6989586621679307835"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-550"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307838"><span class="hs-identifier hs-var">haType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-551"></a><span>         </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-552"></a><span>         </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#getEcho"><span class="hs-identifier hs-var">IODevice.getEcho</span></a><span> </span><a href="#local-6989586621679307837"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-comment">-- | Is the handle connected to a terminal?</span><span>
</span><a name="line-555"></a><span>
</span><a name="line-556"></a><span class="hs-identifier">hIsTerminalDevice</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span>
</span><a name="line-557"></a><a name="hIsTerminalDevice"><a href="GHC.IO.Handle.html#hIsTerminalDevice"><span class="hs-identifier">hIsTerminalDevice</span></a></a><span> </span><a name="local-6989586621679307850"><a href="#local-6989586621679307850"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-558"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;hIsTerminalDevice&quot;</span><span> </span><a href="#local-6989586621679307850"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-559"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307852"><span class="hs-identifier hs-var">haType</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-560"></a><span>       </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Internals.html#ioe_closedHandle"><span class="hs-identifier hs-var">ioe_closedHandle</span></a><span>
</span><a name="line-561"></a><span>       </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Device.html#isTerminal"><span class="hs-identifier hs-var">IODevice.isTerminal</span></a><span> </span><a href="#local-6989586621679307851"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-564"></a><span class="hs-comment">-- hSetBinaryMode</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-comment">-- | Select binary mode ('True') or text mode ('False') on a open handle.</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- (See also 'openBinaryFile'.)</span><span>
</span><a name="line-568"></a><span class="hs-comment">--</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- This has the same effect as calling 'hSetEncoding' with 'char8', together</span><span>
</span><a name="line-570"></a><span class="hs-comment">-- with 'hSetNewlineMode' with 'noNewlineTranslation'.</span><span>
</span><a name="line-571"></a><span class="hs-comment">--</span><span>
</span><a name="line-572"></a><span class="hs-identifier">hSetBinaryMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-573"></a><a name="hSetBinaryMode"><a href="GHC.IO.Handle.html#hSetBinaryMode"><span class="hs-identifier">hSetBinaryMode</span></a></a><span> </span><a name="local-6989586621679307864"><a href="#local-6989586621679307864"><span class="hs-identifier">handle</span></a></a><span> </span><a name="local-6989586621679307865"><a href="#local-6989586621679307865"><span class="hs-identifier">bin</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-574"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withAllHandles__"><span class="hs-identifier hs-var">withAllHandles__</span></a><span> </span><span class="hs-string">&quot;hSetBinaryMode&quot;</span><span> </span><a href="#local-6989586621679307864"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307866"><a href="#local-6989586621679307866"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-575"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-576"></a><span>         </span><a href="GHC.IO.Handle.Internals.html#flushCharBuffer"><span class="hs-identifier hs-var">flushCharBuffer</span></a><span> </span><a href="#local-6989586621679307866"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-577"></a><span>         </span><a href="GHC.IO.Handle.Internals.html#closeTextCodecs"><span class="hs-identifier hs-var">closeTextCodecs</span></a><span> </span><a href="#local-6989586621679307866"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span>         </span><a name="local-6989586621679307880"><a href="#local-6989586621679307880"><span class="hs-identifier">mb_te</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679307865"><span class="hs-identifier hs-var">bin</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-580"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><a href="GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Encoding.html#getLocaleEncoding"><span class="hs-identifier hs-var">getLocaleEncoding</span></a><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span>         </span><a href="GHC.IO.Handle.Internals.html#openTextEncoding"><span class="hs-identifier hs-var">openTextEncoding</span></a><span> </span><a href="#local-6989586621679307880"><span class="hs-identifier hs-var">mb_te</span></a><span> </span><a href="#local-6989586621679307868"><span class="hs-identifier hs-var">haType</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679307881"><a href="#local-6989586621679307881"><span class="hs-identifier">mb_encoder</span></a></a><span> </span><a name="local-6989586621679307882"><a href="#local-6989586621679307882"><span class="hs-identifier">mb_decoder</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span>         </span><span class="hs-comment">-- should match the default newline mode, whatever that is</span><span>
</span><a name="line-585"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679307883"><a href="#local-6989586621679307883"><span class="hs-identifier">nl</span></a></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679307865"><span class="hs-identifier hs-var">bin</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Types.html#noNewlineTranslation"><span class="hs-identifier hs-var">noNewlineTranslation</span></a><span>
</span><a name="line-586"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.Types.html#nativeNewlineMode"><span class="hs-identifier hs-var">nativeNewlineMode</span></a><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span>         </span><a name="local-6989586621679307884"><a href="#local-6989586621679307884"><span class="hs-identifier">bbuf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621679307869"><span class="hs-identifier hs-var">haByteBuffer</span></a><span>
</span><a name="line-589"></a><span>         </span><a name="local-6989586621679307885"><a href="#local-6989586621679307885"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Err.html#errorWithoutStackTrace"><span class="hs-identifier hs-var">errorWithoutStackTrace</span></a><span> </span><span class="hs-string">&quot;codec_state&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679307884"><span class="hs-identifier hs-var">bbuf</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>
</span><a name="line-591"></a><span>         </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">haLastDecode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307885"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">,</span><span>
</span><a name="line-592"></a><span>                          </span><span class="hs-identifier">haEncoder</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307881"><span class="hs-identifier hs-var">mb_encoder</span></a><span class="hs-special">,</span><span>
</span><a name="line-593"></a><span>                          </span><span class="hs-identifier">haDecoder</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307882"><span class="hs-identifier hs-var">mb_decoder</span></a><span class="hs-special">,</span><span>
</span><a name="line-594"></a><span>                          </span><span class="hs-identifier">haCodec</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307880"><span class="hs-identifier hs-var">mb_te</span></a><span class="hs-special">,</span><span>
</span><a name="line-595"></a><span>                          </span><span class="hs-identifier">haInputNL</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inputNL</span><span> </span><a href="#local-6989586621679307883"><span class="hs-identifier hs-var">nl</span></a><span class="hs-special">,</span><span>
</span><a name="line-596"></a><span>                          </span><span class="hs-identifier">haOutputNL</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">outputNL</span><span> </span><a href="#local-6989586621679307883"><span class="hs-identifier hs-var">nl</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- hSetNewlineMode</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-comment">-- | Set the 'NewlineMode' on the specified 'Handle'.  All buffered</span><span>
</span><a name="line-602"></a><span class="hs-comment">-- data is flushed first.</span><span>
</span><a name="line-603"></a><span class="hs-identifier">hSetNewlineMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#NewlineMode"><span class="hs-identifier hs-type">NewlineMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-604"></a><a name="hSetNewlineMode"><a href="GHC.IO.Handle.html#hSetNewlineMode"><span class="hs-identifier">hSetNewlineMode</span></a></a><span> </span><a name="local-6989586621679307886"><a href="#local-6989586621679307886"><span class="hs-identifier">handle</span></a></a><span> </span><a href="GHC.IO.Handle.Types.html#NewlineMode"><span class="hs-identifier hs-var">NewlineMode</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">inputNL</span><span class="hs-glyph">=</span><a name="local-6989586621679307887"><a href="#local-6989586621679307887"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">outputNL</span><span class="hs-glyph">=</span><a name="local-6989586621679307888"><a href="#local-6989586621679307888"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-605"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withAllHandles__"><span class="hs-identifier hs-var">withAllHandles__</span></a><span> </span><span class="hs-string">&quot;hSetNewlineMode&quot;</span><span> </span><a href="#local-6989586621679307886"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307889"><a href="#local-6989586621679307889"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-606"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-607"></a><span>         </span><a href="GHC.IO.Handle.Internals.html#flushBuffer"><span class="hs-identifier hs-var">flushBuffer</span></a><span> </span><a href="#local-6989586621679307889"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-608"></a><span>         </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679307889"><span class="hs-identifier hs-var">h_</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">haInputNL</span><span class="hs-glyph">=</span><a href="#local-6989586621679307887"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">haOutputNL</span><span class="hs-glyph">=</span><a href="#local-6989586621679307888"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-611"></a><span class="hs-comment">-- Duplicating a Handle</span><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span class="hs-comment">-- | Returns a duplicate of the original handle, with its own buffer.</span><span>
</span><a name="line-614"></a><span class="hs-comment">-- The two Handles will share a file pointer, however.  The original</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- handle's buffer is flushed, including discarding any input data,</span><span>
</span><a name="line-616"></a><span class="hs-comment">-- before the handle is duplicated.</span><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span class="hs-identifier">hDuplicate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span>
</span><a name="line-619"></a><a name="hDuplicate"><a href="GHC.IO.Handle.html#hDuplicate"><span class="hs-identifier">hDuplicate</span></a></a><span> </span><a name="local-6989586621679307903"><a href="#local-6989586621679307903"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><a name="local-6989586621679307904"><a href="#local-6989586621679307904"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679307905"><a href="#local-6989586621679307905"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-620"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicate&quot;</span><span> </span><a href="#local-6989586621679307903"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307905"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307906"><a href="#local-6989586621679307906"><span class="hs-identifier">h_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-621"></a><span>      </span><a href="GHC.IO.Handle.html#dupHandle"><span class="hs-identifier hs-var">dupHandle</span></a><span> </span><a href="#local-6989586621679307904"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307903"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679307906"><span class="hs-identifier hs-var">h_</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#handleFinalizer"><span class="hs-identifier hs-var">handleFinalizer</span></a><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span class="hs-identifier">hDuplicate</span><span> </span><a name="local-6989586621679307907"><a href="#local-6989586621679307907"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><a name="local-6989586621679307908"><a href="#local-6989586621679307908"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679307909"><a href="#local-6989586621679307909"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679307910"><a href="#local-6989586621679307910"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-623"></a><span>  </span><a name="local-6989586621679307912"><a href="#local-6989586621679307912"><span class="hs-identifier">write_side</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307913"><a href="#local-6989586621679307913"><span class="hs-identifier">write_m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-624"></a><span>     </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicate&quot;</span><span> </span><a href="#local-6989586621679307907"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307910"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307911"><a href="#local-6989586621679307911"><span class="hs-identifier">h_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-625"></a><span>        </span><a href="GHC.IO.Handle.html#dupHandle"><span class="hs-identifier hs-var">dupHandle</span></a><span> </span><a href="#local-6989586621679307908"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307907"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679307911"><span class="hs-identifier hs-var">h_</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#handleFinalizer"><span class="hs-identifier hs-var">handleFinalizer</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>  </span><a name="local-6989586621679307915"><a href="#local-6989586621679307915"><span class="hs-identifier">read_side</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307916"><a href="#local-6989586621679307916"><span class="hs-identifier">read_m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-627"></a><span>    </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicate&quot;</span><span> </span><a href="#local-6989586621679307907"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307909"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307914"><a href="#local-6989586621679307914"><span class="hs-identifier">h_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-628"></a><span>        </span><a href="GHC.IO.Handle.html#dupHandle"><span class="hs-identifier hs-var">dupHandle</span></a><span> </span><a href="#local-6989586621679307908"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307907"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679307913"><span class="hs-identifier hs-var">write_m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679307914"><span class="hs-identifier hs-var">h_</span></a><span>  </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-629"></a><span>  </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><a href="#local-6989586621679307908"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307916"><span class="hs-identifier hs-var">read_m</span></a><span> </span><a href="#local-6989586621679307913"><span class="hs-identifier hs-var">write_m</span></a><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-identifier">dupHandle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-632"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span>
</span><a name="line-633"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span class="hs-special">)</span><span>
</span><a name="line-634"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span>
</span><a name="line-635"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#HandleFinalizer"><span class="hs-identifier hs-type">HandleFinalizer</span></a><span>
</span><a name="line-636"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span>
</span><a name="line-637"></a><a name="dupHandle"><a href="GHC.IO.Handle.html#dupHandle"><span class="hs-identifier">dupHandle</span></a></a><span> </span><a name="local-6989586621679307917"><a href="#local-6989586621679307917"><span class="hs-identifier">filepath</span></a></a><span> </span><a name="local-6989586621679307918"><a href="#local-6989586621679307918"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679307919"><a href="#local-6989586621679307919"><span class="hs-identifier">other_side</span></a></a><span> </span><a name="local-6989586621679307920"><a href="#local-6989586621679307920"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679307934"><a href="#local-6989586621679307934"><span class="hs-identifier">mb_finalizer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-638"></a><span>  </span><span class="hs-comment">-- flush the buffer first, so we don't have to copy its contents</span><span>
</span><a name="line-639"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#flushBuffer"><span class="hs-identifier hs-var">flushBuffer</span></a><span> </span><a href="#local-6989586621679307920"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-640"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679307919"><span class="hs-identifier hs-var">other_side</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-641"></a><span>    </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-642"></a><span>       </span><a name="local-6989586621679307935"><a href="#local-6989586621679307935"><span class="hs-identifier">new_dev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Device.html#dup"><span class="hs-identifier hs-var">IODevice.dup</span></a><span> </span><a href="#local-6989586621679307921"><span class="hs-identifier hs-var">haDevice</span></a><span>
</span><a name="line-643"></a><span>       </span><a href="GHC.IO.Handle.html#dupHandle_"><span class="hs-identifier hs-var">dupHandle_</span></a><span> </span><a href="#local-6989586621679307935"><span class="hs-identifier hs-var">new_dev</span></a><span> </span><a href="#local-6989586621679307917"><span class="hs-identifier hs-var">filepath</span></a><span> </span><a href="#local-6989586621679307919"><span class="hs-identifier hs-var">other_side</span></a><span> </span><a href="#local-6989586621679307920"><span class="hs-identifier hs-var">h_</span></a><span> </span><a href="#local-6989586621679307934"><span class="hs-identifier hs-var">mb_finalizer</span></a><span>
</span><a name="line-644"></a><span>    </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679307936"><a href="#local-6989586621679307936"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-645"></a><span>       </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;dupHandle&quot;</span><span> </span><a href="#local-6989586621679307918"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679307936"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-identifier">haDevice</span><span class="hs-glyph">=</span><a name="local-6989586621679307937"><a href="#local-6989586621679307937"><span class="hs-identifier">dev</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-646"></a><span>         </span><a href="GHC.IO.Handle.html#dupHandle_"><span class="hs-identifier hs-var">dupHandle_</span></a><span> </span><a href="#local-6989586621679307937"><span class="hs-identifier hs-var">dev</span></a><span> </span><a href="#local-6989586621679307917"><span class="hs-identifier hs-var">filepath</span></a><span> </span><a href="#local-6989586621679307919"><span class="hs-identifier hs-var">other_side</span></a><span> </span><a href="#local-6989586621679307920"><span class="hs-identifier hs-var">h_</span></a><span> </span><a href="#local-6989586621679307934"><span class="hs-identifier hs-var">mb_finalizer</span></a><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-identifier">dupHandle_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="GHC.IO.Device.html#IODevice"><span class="hs-identifier hs-type">IODevice</span></a><span> </span><a href="#local-6989586621679307651"><span class="hs-identifier hs-type">dev</span></a><span class="hs-special">,</span><span> </span><a href="GHC.IO.BufferedIO.html#BufferedIO"><span class="hs-identifier hs-type">BufferedIO</span></a><span> </span><a href="#local-6989586621679307651"><span class="hs-identifier hs-type">dev</span></a><span class="hs-special">,</span><span> </span><a href="Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a><span> </span><a href="#local-6989586621679307651"><span class="hs-identifier hs-type">dev</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679307651"><span class="hs-identifier hs-type">dev</span></a><span>
</span><a name="line-649"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-650"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span>
</span><a name="line-652"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#HandleFinalizer"><span class="hs-identifier hs-type">HandleFinalizer</span></a><span>
</span><a name="line-653"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span>
</span><a name="line-654"></a><a name="dupHandle_"><a href="GHC.IO.Handle.html#dupHandle_"><span class="hs-identifier">dupHandle_</span></a></a><span> </span><a name="local-6989586621679307938"><a href="#local-6989586621679307938"><span class="hs-identifier">new_dev</span></a></a><span> </span><a name="local-6989586621679307939"><a href="#local-6989586621679307939"><span class="hs-identifier">filepath</span></a></a><span> </span><a name="local-6989586621679307940"><a href="#local-6989586621679307940"><span class="hs-identifier">other_side</span></a></a><span> </span><a name="local-6989586621679307941"><a href="#local-6989586621679307941"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679307955"><a href="#local-6989586621679307955"><span class="hs-identifier">mb_finalizer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-655"></a><span>   </span><span class="hs-comment">-- XXX wrong!</span><span>
</span><a name="line-656"></a><span>  </span><a name="local-6989586621679307956"><a href="#local-6989586621679307956"><span class="hs-identifier">mb_codec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><a href="#local-6989586621679307949"><span class="hs-identifier hs-var">haEncoder</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Encoding.html#getLocaleEncoding"><span class="hs-identifier hs-var">getLocaleEncoding</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-657"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#mkHandle"><span class="hs-identifier hs-var">mkHandle</span></a><span> </span><a href="#local-6989586621679307938"><span class="hs-identifier hs-var">new_dev</span></a><span> </span><a href="#local-6989586621679307939"><span class="hs-identifier hs-var">filepath</span></a><span> </span><a href="#local-6989586621679307943"><span class="hs-identifier hs-var">haType</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span class="hs-comment">{-buffered-}</span><span> </span><a href="#local-6989586621679307956"><span class="hs-identifier hs-var">mb_codec</span></a><span>
</span><a name="line-658"></a><span>      </span><a href="GHC.IO.Handle.Types.html#NewlineMode"><span class="hs-identifier hs-var">NewlineMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">inputNL</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307952"><span class="hs-identifier hs-var">haInputNL</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">outputNL</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679307953"><span class="hs-identifier hs-var">haOutputNL</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-659"></a><span>      </span><a href="#local-6989586621679307955"><span class="hs-identifier hs-var">mb_finalizer</span></a><span> </span><a href="#local-6989586621679307940"><span class="hs-identifier hs-var">other_side</span></a><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-662"></a><span class="hs-comment">-- Replacing a Handle</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">{- |
Makes the second handle a duplicate of the first handle.  The second
handle will be closed first, if it is not already.

This can be used to retarget the standard Handles, for example:

&gt; do h &lt;- openFile &quot;mystdout&quot; WriteMode
&gt;    hDuplicateTo h stdout
-}</span><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-identifier">hDuplicateTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-675"></a><a name="hDuplicateTo"><a href="GHC.IO.Handle.html#hDuplicateTo"><span class="hs-identifier">hDuplicateTo</span></a></a><span> </span><a name="local-6989586621679307957"><a href="#local-6989586621679307957"><span class="hs-identifier">h1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><a name="local-6989586621679307958"><a href="#local-6989586621679307958"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679307959"><a href="#local-6989586621679307959"><span class="hs-identifier">m1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679307960"><a href="#local-6989586621679307960"><span class="hs-identifier">h2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307961"><a href="#local-6989586621679307961"><span class="hs-identifier">m2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-676"></a><span> </span><a href="GHC.IO.Handle.Internals.html#withHandle__%27"><span class="hs-identifier hs-var">withHandle__'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307960"><span class="hs-identifier hs-var">h2</span></a><span> </span><a href="#local-6989586621679307961"><span class="hs-identifier hs-var">m2</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307962"><a href="#local-6989586621679307962"><span class="hs-identifier">h2_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-677"></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.Internals.html#hClose_help"><span class="hs-identifier hs-var">hClose_help</span></a><span> </span><a href="#local-6989586621679307962"><span class="hs-identifier hs-var">h2_</span></a><span>
</span><a name="line-678"></a><span>   </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307957"><span class="hs-identifier hs-var">h1</span></a><span> </span><a href="#local-6989586621679307959"><span class="hs-identifier hs-var">m1</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307963"><a href="#local-6989586621679307963"><span class="hs-identifier">h1_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-679"></a><span>     </span><a href="GHC.IO.Handle.html#dupHandleTo"><span class="hs-identifier hs-var">dupHandleTo</span></a><span> </span><a href="#local-6989586621679307958"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307957"><span class="hs-identifier hs-var">h1</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679307962"><span class="hs-identifier hs-var">h2_</span></a><span> </span><a href="#local-6989586621679307963"><span class="hs-identifier hs-var">h1_</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#handleFinalizer"><span class="hs-identifier hs-var">handleFinalizer</span></a><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span class="hs-identifier">hDuplicateTo</span><span> </span><a name="local-6989586621679307964"><a href="#local-6989586621679307964"><span class="hs-identifier">h1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><a name="local-6989586621679307965"><a href="#local-6989586621679307965"><span class="hs-identifier">path</span></a></a><span> </span><a name="local-6989586621679307966"><a href="#local-6989586621679307966"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679307967"><a href="#local-6989586621679307967"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679307968"><a href="#local-6989586621679307968"><span class="hs-identifier">h2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307969"><a href="#local-6989586621679307969"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679307970"><a href="#local-6989586621679307970"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-681"></a><span> </span><a href="GHC.IO.Handle.Internals.html#withHandle__%27"><span class="hs-identifier hs-var">withHandle__'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307968"><span class="hs-identifier hs-var">h2</span></a><span> </span><a href="#local-6989586621679307970"><span class="hs-identifier hs-var">w2</span></a><span>  </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307971"><a href="#local-6989586621679307971"><span class="hs-identifier">w2_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-682"></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.Internals.html#hClose_help"><span class="hs-identifier hs-var">hClose_help</span></a><span> </span><a href="#local-6989586621679307971"><span class="hs-identifier hs-var">w2_</span></a><span>
</span><a name="line-683"></a><span>   </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307964"><span class="hs-identifier hs-var">h1</span></a><span> </span><a href="#local-6989586621679307967"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307972"><a href="#local-6989586621679307972"><span class="hs-identifier">w1_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-684"></a><span>     </span><a href="GHC.IO.Handle.html#dupHandleTo"><span class="hs-identifier hs-var">dupHandleTo</span></a><span> </span><a href="#local-6989586621679307965"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307964"><span class="hs-identifier hs-var">h1</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-6989586621679307971"><span class="hs-identifier hs-var">w2_</span></a><span> </span><a href="#local-6989586621679307972"><span class="hs-identifier hs-var">w1_</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#handleFinalizer"><span class="hs-identifier hs-var">handleFinalizer</span></a><span class="hs-special">)</span><span>
</span><a name="line-685"></a><span> </span><a href="GHC.IO.Handle.Internals.html#withHandle__%27"><span class="hs-identifier hs-var">withHandle__'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307968"><span class="hs-identifier hs-var">h2</span></a><span> </span><a href="#local-6989586621679307969"><span class="hs-identifier hs-var">r2</span></a><span>  </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307973"><a href="#local-6989586621679307973"><span class="hs-identifier">r2_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-686"></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.Internals.html#hClose_help"><span class="hs-identifier hs-var">hClose_help</span></a><span> </span><a href="#local-6989586621679307973"><span class="hs-identifier hs-var">r2_</span></a><span>
</span><a name="line-687"></a><span>   </span><a href="GHC.IO.Handle.Internals.html#withHandle_%27"><span class="hs-identifier hs-var">withHandle_'</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span> </span><a href="#local-6989586621679307964"><span class="hs-identifier hs-var">h1</span></a><span> </span><a href="#local-6989586621679307966"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679307974"><a href="#local-6989586621679307974"><span class="hs-identifier">r1_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-688"></a><span>     </span><a href="GHC.IO.Handle.html#dupHandleTo"><span class="hs-identifier hs-var">dupHandleTo</span></a><span> </span><a href="#local-6989586621679307965"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679307964"><span class="hs-identifier hs-var">h1</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679307967"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679307973"><span class="hs-identifier hs-var">r2_</span></a><span> </span><a href="#local-6989586621679307974"><span class="hs-identifier hs-var">r1_</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-689"></a><span class="hs-identifier">hDuplicateTo</span><span> </span><a name="local-6989586621679307975"><a href="#local-6989586621679307975"><span class="hs-identifier">h1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-690"></a><span>  </span><a href="GHC.IO.Handle.html#ioe_dupHandlesNotCompatible"><span class="hs-identifier hs-var">ioe_dupHandlesNotCompatible</span></a><span> </span><a href="#local-6989586621679307975"><span class="hs-identifier hs-var">h1</span></a><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span class="hs-identifier">ioe_dupHandlesNotCompatible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="#local-6989586621679307650"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-694"></a><a name="ioe_dupHandlesNotCompatible"><a href="GHC.IO.Handle.html#ioe_dupHandlesNotCompatible"><span class="hs-identifier">ioe_dupHandlesNotCompatible</span></a></a><span> </span><a name="local-6989586621679307976"><a href="#local-6989586621679307976"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-695"></a><span>   </span><a href="GHC.IO.Exception.html#ioException"><span class="hs-identifier hs-var">ioException</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Exception.html#IOError"><span class="hs-identifier hs-var">IOError</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-6989586621679307976"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="GHC.IO.Exception.html#IllegalOperation"><span class="hs-identifier hs-var">IllegalOperation</span></a><span> </span><span class="hs-string">&quot;hDuplicateTo&quot;</span><span>
</span><a name="line-696"></a><span>                </span><span class="hs-string">&quot;handles are incompatible&quot;</span><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-697"></a><span>
</span><a name="line-698"></a><span class="hs-identifier">dupHandleTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>
</span><a name="line-699"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span>
</span><a name="line-700"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span class="hs-special">)</span><span>
</span><a name="line-701"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span>
</span><a name="line-702"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span>
</span><a name="line-703"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.IO.Handle.Internals.html#HandleFinalizer"><span class="hs-identifier hs-type">HandleFinalizer</span></a><span>
</span><a name="line-704"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-type">Handle__</span></a><span>
</span><a name="line-705"></a><a name="dupHandleTo"><a href="GHC.IO.Handle.html#dupHandleTo"><span class="hs-identifier">dupHandleTo</span></a></a><span> </span><a name="local-6989586621679307977"><a href="#local-6989586621679307977"><span class="hs-identifier">filepath</span></a></a><span> </span><a name="local-6989586621679307978"><a href="#local-6989586621679307978"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679307979"><a href="#local-6989586621679307979"><span class="hs-identifier">other_side</span></a></a><span>
</span><a name="line-706"></a><span>            </span><a name="local-6989586621679307980"><a href="#local-6989586621679307980"><span class="hs-identifier">hto_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-identifier">haDevice</span><span class="hs-glyph">=</span><a name="local-6989586621679307981"><a href="#local-6989586621679307981"><span class="hs-identifier">devTo</span></a></a><span class="hs-special">,</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-707"></a><span>            </span><a name="local-6989586621679307994"><a href="#local-6989586621679307994"><span class="hs-identifier">h_</span></a></a><span class="hs-glyph">@</span><a href="GHC.IO.Handle.Types.html#Handle__"><span class="hs-identifier hs-var">Handle__</span></a><span class="hs-special">{</span><span class="hs-identifier">haDevice</span><span class="hs-glyph">=</span><a name="local-6989586621679307995"><a href="#local-6989586621679307995"><span class="hs-identifier">dev</span></a></a><span class="hs-special">}</span><span> </span><a name="local-6989586621679307996"><a href="#local-6989586621679307996"><span class="hs-identifier">mb_finalizer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-708"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#flushBuffer"><span class="hs-identifier hs-var">flushBuffer</span></a><span> </span><a href="#local-6989586621679307994"><span class="hs-identifier hs-var">h_</span></a><span>
</span><a name="line-709"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Data.Typeable.html#cast"><span class="hs-identifier hs-var">cast</span></a><span> </span><a href="#local-6989586621679307981"><span class="hs-identifier hs-var">devTo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-710"></a><span>    </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.html#ioe_dupHandlesNotCompatible"><span class="hs-identifier hs-var">ioe_dupHandlesNotCompatible</span></a><span> </span><a href="#local-6989586621679307978"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-711"></a><span>    </span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679307997"><a href="#local-6989586621679307997"><span class="hs-identifier">dev'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-712"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Device.html#dup2"><span class="hs-identifier hs-var">IODevice.dup2</span></a><span> </span><a href="#local-6989586621679307995"><span class="hs-identifier hs-var">dev</span></a><span> </span><a href="#local-6989586621679307997"><span class="hs-identifier hs-var">dev'</span></a><span>
</span><a name="line-713"></a><span>      </span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679307998"><a href="#local-6989586621679307998"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.IO.Handle.html#dupHandle_"><span class="hs-identifier hs-var">dupHandle_</span></a><span> </span><a href="#local-6989586621679307997"><span class="hs-identifier hs-var">dev'</span></a><span> </span><a href="#local-6989586621679307977"><span class="hs-identifier hs-var">filepath</span></a><span> </span><a href="#local-6989586621679307979"><span class="hs-identifier hs-var">other_side</span></a><span> </span><a href="#local-6989586621679307994"><span class="hs-identifier hs-var">h_</span></a><span> </span><a href="#local-6989586621679307996"><span class="hs-identifier hs-var">mb_finalizer</span></a><span>
</span><a name="line-714"></a><span>      </span><a href="GHC.MVar.html#takeMVar"><span class="hs-identifier hs-var">takeMVar</span></a><span> </span><a href="#local-6989586621679307998"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-715"></a><span>
</span><a name="line-716"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-717"></a><span class="hs-comment">-- showing Handles.</span><span>
</span><a name="line-718"></a><span class="hs-comment">--</span><span>
</span><a name="line-719"></a><span class="hs-comment">-- | 'hShow' is in the 'IO' monad, and gives more comprehensive output</span><span>
</span><a name="line-720"></a><span class="hs-comment">-- than the (pure) instance of 'Show' for 'Handle'.</span><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-identifier">hShow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-723"></a><a name="hShow"><a href="GHC.IO.Handle.html#hShow"><span class="hs-identifier">hShow</span></a></a><span> </span><a name="local-6989586621679307999"><a href="#local-6989586621679307999"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#FileHandle"><span class="hs-identifier hs-var">FileHandle</span></a><span> </span><a name="local-6989586621679308000"><a href="#local-6989586621679308000"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.html#showHandle%27"><span class="hs-identifier hs-var">showHandle'</span></a><span> </span><a href="#local-6989586621679308000"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a><span> </span><a href="#local-6989586621679307999"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-724"></a><span class="hs-identifier">hShow</span><span> </span><a name="local-6989586621679308001"><a href="#local-6989586621679308001"><span class="hs-identifier">h</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="GHC.IO.Handle.Types.html#DuplexHandle"><span class="hs-identifier hs-var">DuplexHandle</span></a><span> </span><a name="local-6989586621679308002"><a href="#local-6989586621679308002"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.IO.Handle.html#showHandle%27"><span class="hs-identifier hs-var">showHandle'</span></a><span> </span><a href="#local-6989586621679308002"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span> </span><a href="#local-6989586621679308001"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-725"></a><span>
</span><a name="line-726"></a><span class="hs-identifier">showHandle'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">Handle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-727"></a><a name="showHandle%27"><a href="GHC.IO.Handle.html#showHandle%27"><span class="hs-identifier">showHandle'</span></a></a><span> </span><a name="local-6989586621679308003"><a href="#local-6989586621679308003"><span class="hs-identifier">filepath</span></a></a><span> </span><a name="local-6989586621679308004"><a href="#local-6989586621679308004"><span class="hs-identifier">is_duplex</span></a></a><span> </span><a name="local-6989586621679308005"><a href="#local-6989586621679308005"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-728"></a><span>  </span><a href="GHC.IO.Handle.Internals.html#withHandle_"><span class="hs-identifier hs-var">withHandle_</span></a><span> </span><span class="hs-string">&quot;showHandle&quot;</span><span> </span><a href="#local-6989586621679308005"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679308015"><a href="#local-6989586621679308015"><span class="hs-identifier">hdl_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-729"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-730"></a><span>     </span><a name="local-6989586621679308016"><a href="#local-6989586621679308016"><span class="hs-identifier">showType</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679308004"><span class="hs-identifier hs-var">is_duplex</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;duplex (read-write)&quot;</span><span>
</span><a name="line-731"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679308015"><span class="hs-identifier hs-var">hdl_</span></a><span class="hs-special">)</span><span>
</span><a name="line-732"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-733"></a><span>    </span><a href="GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span>
</span><a name="line-734"></a><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span> </span><a href="GHC.Show.html#showChar"><span class="hs-identifier hs-var">showChar</span></a><span> </span><span class="hs-char">'{'</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span>
</span><a name="line-735"></a><span>        </span><a href="#local-6989586621679308006"><span class="hs-identifier hs-var">showHdl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haType</span><span> </span><a href="#local-6989586621679308015"><span class="hs-identifier hs-var">hdl_</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>            </span><span class="hs-special">(</span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;loc=&quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><a href="#local-6989586621679308003"><span class="hs-identifier hs-var">filepath</span></a><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showChar"><span class="hs-identifier hs-var">showChar</span></a><span> </span><span class="hs-char">','</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span>
</span><a name="line-737"></a><span>             </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;type=&quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679308016"><span class="hs-identifier hs-var">showType</span></a><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showChar"><span class="hs-identifier hs-var">showChar</span></a><span> </span><span class="hs-char">','</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span>
</span><a name="line-738"></a><span>             </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;buffering=&quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-6989586621679308007"><span class="hs-identifier hs-var">showBufMode</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IO.Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a><span> </span><span class="hs-special">(</span><a href="GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">haCharBuffer</span><span> </span><a href="#local-6989586621679308015"><span class="hs-identifier hs-var">hdl_</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">haBufferMode</span><span> </span><a href="#local-6989586621679308015"><span class="hs-identifier hs-var">hdl_</span></a><span class="hs-special">)</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;}&quot;</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span>    </span><span class="hs-identifier">showHdl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Handle.Types.html#HandleType"><span class="hs-identifier hs-type">HandleType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#ShowS"><span class="hs-identifier hs-type">ShowS</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#ShowS"><span class="hs-identifier hs-type">ShowS</span></a><span>
</span><a name="line-743"></a><span>    </span><a name="local-6989586621679308006"><a href="#local-6989586621679308006"><span class="hs-identifier">showHdl</span></a></a><span> </span><a name="local-6989586621679308009"><a href="#local-6989586621679308009"><span class="hs-identifier">ht</span></a></a><span> </span><a name="local-6989586621679308010"><a href="#local-6989586621679308010"><span class="hs-identifier">cont</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-744"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679308009"><span class="hs-identifier hs-var">ht</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-745"></a><span>        </span><a href="GHC.IO.Handle.Types.html#ClosedHandle"><span class="hs-identifier hs-var">ClosedHandle</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679308009"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;}&quot;</span><span>
</span><a name="line-746"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679308010"><span class="hs-identifier hs-var">cont</span></a><span>
</span><a name="line-747"></a><span>
</span><a name="line-748"></a><span>    </span><span class="hs-identifier">showBufMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.IO.Buffer.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a><span> </span><a href="#local-6989586621679308008"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.IO.Handle.Types.html#BufferMode"><span class="hs-identifier hs-type">BufferMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#ShowS"><span class="hs-identifier hs-type">ShowS</span></a><span>
</span><a name="line-749"></a><span>    </span><a name="local-6989586621679308007"><a href="#local-6989586621679308007"><span class="hs-identifier">showBufMode</span></a></a><span> </span><a name="local-6989586621679308011"><a href="#local-6989586621679308011"><span class="hs-identifier">buf</span></a></a><span> </span><a name="local-6989586621679308012"><a href="#local-6989586621679308012"><span class="hs-identifier">bmo</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-750"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679308012"><span class="hs-identifier hs-var">bmo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-751"></a><span>        </span><a href="GHC.IO.Handle.Types.html#NoBuffering"><span class="hs-identifier hs-var">NoBuffering</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;none&quot;</span><span>
</span><a name="line-752"></a><span>        </span><a href="GHC.IO.Handle.Types.html#LineBuffering"><span class="hs-identifier hs-var">LineBuffering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;line&quot;</span><span>
</span><a name="line-753"></a><span>        </span><a href="GHC.IO.Handle.Types.html#BlockBuffering"><span class="hs-identifier hs-var">BlockBuffering</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679308014"><a href="#local-6989586621679308014"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;block &quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showParen"><span class="hs-identifier hs-var">showParen</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679308014"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-754"></a><span>        </span><a href="GHC.IO.Handle.Types.html#BlockBuffering"><span class="hs-identifier hs-var">BlockBuffering</span></a><span> </span><a href="GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.Show.html#showString"><span class="hs-identifier hs-var">showString</span></a><span> </span><span class="hs-string">&quot;block &quot;</span><span> </span><a href="GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="GHC.Show.html#showParen"><span class="hs-identifier hs-var">showParen</span></a><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a><span> </span><span class="hs-special">(</span><a href="GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679308013"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-756"></a><span>       </span><span class="hs-identifier">def</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../ghc-prim-0.5.2.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span>
</span><a name="line-757"></a><span>       </span><a name="local-6989586621679308013"><a href="#local-6989586621679308013"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bufSize</span><span> </span><a href="#local-6989586621679308011"><span class="hs-identifier hs-var">buf</span></a><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a></pre></body></html>